@using sms_source.Areas.admin.Models
@model List<sms_send_log>
@{
    ViewBag.Title = "SmsPending";
    Layout = "~/Areas/admin/Views/Shared/admin.cshtml";
}

<h2>Tra cứu tin nhắn chờ</h2>
<div>
    <fieldset>
        <legend>Tiêu chí tìm kiếm</legend>
        @using (Ajax.BeginForm("SmsPendingSearch", "Sms", new AjaxOptions { UpdateTargetId = "result", InsertionMode = InsertionMode.Replace }))
        {
            <div style="width: 35%; float: left">
                <div class="sub">
                    <div class="editor-label">
                        <label>SĐT người gửi:</label>
                    </div>
                    <div class="editor-field">
                        <input type="number" name="sender_number" />
                    </div>
                </div>
                <div class="sub">
                    <div class="editor-label">
                        <label>Số tổng đài:</label>
                    </div>
                    <div class="editor-field">
                        <input type="number" name="service_number" />
                    </div>
                </div>
                <div class="sub">
                    <div class="editor-label">
                        <label>Mã dịch vụ:</label>
                    </div>
                    <div class="editor-field">
                        <input type="text" name="command_code" />
                    </div>
                </div>
            </div>
            <div style="width: 35%; float: left">
                <div class="sub">
                    <div class="editor-label">
                        <label>Nhà mạng:</label>
                    </div>
                    <div class="editor-field">
                        <select name="telcos">
                            <option value="">Chọn nhà mạng</option>
                            @{
            var listTelco = (List<telcos>)ViewBag.listTelco;
            foreach (var objTelco in listTelco)
            {
                                <option value="@objTelco.id">@objTelco.telcos_name</option>
            }
                            }
                        </select>
                    </div>
                </div>

                @*<div class="sub">
                    <div class="editor-label">
                        <label>Tháng:</label>
                    </div>
                    <div class="editor-field">
                        <select name="cbMonth">
                            <option value="">Chọn</option>
                            @{
                                for (int i = 0; i < 12; i++)
                                {
                                    <option value="@(i + 1)">@(i + 1)</option>
                                }
                            }

                        </select>
                    </div>
                    <div class="editor-label" style="width: 60px;">
                        <label>Năm:</label>
                    </div>
                    <div class="editor-field">
                        <select name="cbYear">
                            <option value="">Chọn</option>
                            @{
                                for (int i = 2010; i < 2014; i++)
                                {
                                    <option value="@(i + 1)">@(i + 1)</option>
                                }
                            }

                        </select>
                    </div>

                </div>
                <div class="sub">

                    <div class="editor-label">
                        <label>Tra cứu theo ngày:</label>
                    </div>
                    <div class="editor-field">
                        <input type="date" id="datepicker" name="txtDate">
                    </div>

                </div>*@
            </div>
            <div style="float: left; left: -25px; position: relative; top: 60px; width: 15%;">
                <input type="submit" class="button" value="Tìm kiếm" />
            </div>
        }

    </fieldset>
</div>

<div style="float: left; width: 100%; margin-top: 15px;">
    <fieldset>
        <legend>Danh sách tin nhắn</legend>
        <div id="result">
            <table class="tableList" cellspacing="0" id="ctphMain_grvUsers">
                <tr class="header">
                    <th align="center" scope="col">STT</th>
                    <th align="left" scope="col">SĐT Khách hàng</th>
                    <th align="left" scope="col">Mã lệnh</th>
                    <th align="left" scope="col">Số tổng đài</th>
                    <th align="left" scope="col">Nhà mạng</th>
                    <th align="left" scope="col" style="width: 350px;">Nội dung trả lời</th>
                    <th align="left" scope="col">Ngày gửi</th>
                    <th scope="col">&nbsp;</th>
                </tr>
                @for (int i = 0; i < Model.Count; i++)
                {
                    var db = new Helper.DbContext<telcos>();
                    db.Select(new[] { "telcos_name" });
                    db.Where("id", Model[i].telcos.ToString());
                    var objTelco = db.FetchObject()[0];

                    var dbMsg = new Helper.DbContext<messages>();
                    dbMsg.Select(new[] { "msg_Content" });
                    dbMsg.Where("id", Model[i].messages_id.ToString());
                    var objMsg = dbMsg.FetchObject()[0];
                    
                    <tr>
                        <td align="center">@(i + 1)
                        </td>
                        <td>@Model[i].sender_number
                        </td>
                        <td>@Model[i].command_code
                        </td>
                        <td>@Model[i].service_number
                        </td>
                        <td>@objTelco.telcos_name
                        </td>
                        <td>@objMsg.msg_Content
                        </td>
                        <td>@Model[i].create_date
                        </td>

                        <td>
                            <a href="#">Chi tiết</a>
                        </td>
                    </tr>
                }


            </table>
        </div>
    </fieldset>
    <div style="float: left; width: 100%;">
        <a style="width: 60px; float: right" href="javascript:;" class="button">Xuất Excel</a>
    </div>
</div>